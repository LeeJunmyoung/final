<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cloud">
<!--===================================================== 클라우드 나타내는 페이지 ======================================-->
	<parameterMap id="listinfo" type="hashMap">
		<parameter property="com_num"/>
		<parameter property="folder"/>	
	</parameterMap>
	<select id="getcloudlist" parameterMap="listinfo" resultType="cloud.db.CloudInfo">
	<choose>
		<when test="folder == null">
		select * from cloud where com_num = #{com_num} and folder is null
		</when>
		<otherwise>
		select * from cloud where com_num = #{com_num} and folder = #{folder}
		</otherwise>
	</choose>
	</select>
	
	<insert id="upload" parameterType="cloud.db.CloudInfo">
		insert into cloud values(cloud_seq.NEXTVAL, #{file_name}, #{file_path}, #{file_uploader}, #{file_size}, sysdate, #{com_num},#{com_pos_num}, #{folder},#{promgr_num},#{mem_num})
	</insert>
	<select id="getFilePath" parameterType="int" resultType="String">
		select file_path from cloud where file_num = #{file_num}
	</select>
	<select id="getFileName" parameterType="int" resultType="String">
		select file_name from cloud where file_num = #{file_num}
	</select>
	<select id="getDeleteList" resultType="cloud.db.CloudInfo">
		select * from cloud 
		<where>
		file_num in
			<foreach collection="array" item="file_num" index="index" separator="," open="(" close=")">
				#{file_num}
			</foreach>
		</where>
	</select>
	<delete id="deleteFiles">
		delete from cloud
		<where>
			file_num in
			<foreach collection="array" item="file_num" index="index" separator="," open="(" close=")">
				#{file_num}
			</foreach>
		</where>
	</delete>
	<select id="dupliCk" parameterType="hashmap" resultType="String">
		select count(*) from cloud
		<where>
		 file_name = #{item} and com_num= #{com_num} and
			<choose>
				<when test="#{folder == '' || folder eq null}" >
					 folder is null
				</when>
				<otherwise>
					folder = #{folder}
				</otherwise>
			</choose>
		
		</where>
	</select>
</mapper>